<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sofn.dao.qry.AdsMonitorTaskExpandMapper" >

    <resultMap id="BaseResultMap" type="com.sofn.model.generator.AdsMonitorTask" >
        <id column="ID" property="id" jdbcType="VARCHAR" />
        <result column="TASK_NAME" property="taskName" jdbcType="VARCHAR" />
        <result column="MONITOR_CLASS" property="monitorClass" jdbcType="VARCHAR" />
        <result column="RELEASE_UNIT" property="releaseUnit" jdbcType="VARCHAR" />
        <result column="CHECK_MODEL" property="checkModel" jdbcType="VARCHAR" />
        <result column="MODEL_TITLE" property="modelTitle" jdbcType="VARCHAR" />
        <result column="YEAR" property="year" jdbcType="VARCHAR" />
        <result column="BATCH" property="batch" jdbcType="VARCHAR" />
        <result column="SEPARATION" property="separation" jdbcType="DECIMAL" />
        <result column="START_TIME" property="startTime" jdbcType="VARCHAR" />
        <result column="END_TIME" property="endTime" jdbcType="VARCHAR" />
        <result column="DEADLINE" property="deadline" jdbcType="VARCHAR" />
        <result column="ATTACHMENT" property="attachment" jdbcType="VARCHAR" />
        <result column="ATTACHMENTCODE" property="attachmentcode" jdbcType="VARCHAR" />
        <result column="COMMENT" property="comment" jdbcType="VARCHAR" />
        <result column="PUBLISH_STATUS" property="publishStatus" jdbcType="DECIMAL" />
        <result column="INDUSTRY" property="industry" jdbcType="VARCHAR" />
        <result column="JUDGE_STANDARD" property="judgeStandard" jdbcType="VARCHAR" />
        <result column="SAMPLE_LINK" property="sampleLink" jdbcType="VARCHAR" />
        <result column="CHECK_OBJECT" property="checkObject" jdbcType="VARCHAR" />
        <result column="CHECK_PROJECT" property="checkProject" jdbcType="VARCHAR" />
        <result column="DEL_FLAG" property="delFlag" jdbcType="VARCHAR" />
        <result column="CREATE_BY" property="createBy" jdbcType="VARCHAR" />
        <result column="UPDATE_BY" property="updateBy" jdbcType="VARCHAR" />
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
        <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
        <result column="RN" property="rn" jdbcType="INTEGER" />
        <result column="LEVE" property="leve" jdbcType="VARCHAR" />
        <result column="ATTACHMENT_ADDRESS" property="attachmentAddress" jdbcType="VARCHAR" />
        <result column="ABOLISH" property="abolish" jdbcType="VARCHAR" />
        <result column="ORGAN_ID" property="organId" jdbcType="VARCHAR" />
        <result column="TASK_SOURCE" property="taskSource" jdbcType="VARCHAR" />
        <result column="SUP_ID" property="supId" jdbcType="VARCHAR" />
        <result column="INDUSTRY_ID" property="industryId" jdbcType="VARCHAR" />
        <result column="CREATE_ORG_REGION_ID" property="createOrgRegionId" jdbcType="VARCHAR" />
        <result column="LEVEL_ENUM" property="levelEnum" jdbcType="VARCHAR" />
    </resultMap>

    <resultMap id="BaseResultMapForOrganTask" type="com.sofn.model.generator.AdsOrganTask" >
        <id column="ID" property="id" jdbcType="VARCHAR" />
        <result column="SAMPLE_REPORT_TIME" property="sampleReportTime" jdbcType="VARCHAR" />
        <result column="CHECK_REPORT_TIME" property="checkReportTime" jdbcType="VARCHAR" />
        <result column="SAMPLE_FINISH_STATUS" property="sampleFinishStatus" jdbcType="DECIMAL" />
        <result column="CHECK_FINISH_STATUS" property="checkFinishStatus" jdbcType="DECIMAL" />
        <result column="SAMPLE_REPORT_STATUS" property="sampleReportStatus" jdbcType="DECIMAL" />
        <result column="CHECK_REPORT_STATUS" property="checkReportStatus" jdbcType="DECIMAL" />
        <result column="MONITOR_TASK_ID" property="monitorTaskId" jdbcType="VARCHAR" />
        <result column="SAMPLE_ORGAN" property="sampleOrgan" jdbcType="VARCHAR" />
        <result column="SAMPLE_ORGAN_ID" property="sampleOrganId" jdbcType="VARCHAR" />
        <result column="DETECTION_ORGAN" property="detectionOrgan" jdbcType="VARCHAR" />
        <result column="DETECTION_ORGAN_ID" property="detectionOrganId" jdbcType="VARCHAR" />
        <result column="CITY_CODE" property="cityCode" jdbcType="VARCHAR" />
        <result column="CITY_NAME" property="cityName" jdbcType="VARCHAR" />
        <result column="REG_ID" property="regId" jdbcType="VARCHAR" />
        <result column="REG_NAME" property="regName" jdbcType="VARCHAR" />
        <result column="NUMBERS" property="numbers" jdbcType="DECIMAL" />
        <result column="DEPARMENT" property="deparment" jdbcType="VARCHAR" />
        <result column="DEPARMENT_ID" property="deparmentId" jdbcType="VARCHAR" />
        <result column="UPLOAD_TIME" property="uploadTime" jdbcType="VARCHAR" />
        <result column="FINISH_NUM" property="finishNum" jdbcType="DECIMAL" />
        <result column="REPORT_STATUS" property="reportStatus" jdbcType="VARCHAR" />
        <result column="REPORT_TIME" property="reportTime" jdbcType="VARCHAR" />
        <result column="TASKS_STATUS" property="tasksStatus" jdbcType="VARCHAR" />
        <result column="SAMPLE_FINISH_NUM" property="sampleFinishNum" jdbcType="DECIMAL" />
        <result column="CHECK_FINISH_NUM" property="checkFinishNum" jdbcType="DECIMAL" />
        <result column="DEL_FLAG" property="delFlag" jdbcType="VARCHAR" />
        <result column="CREATE_BY" property="createBy" jdbcType="VARCHAR" />
        <result column="UPDATE_BY" property="updateBy" jdbcType="VARCHAR" />
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
        <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
        <result column="RN" property="rn" jdbcType="INTEGER" />
    </resultMap>

    <resultMap id="joinSelectScore" type="com.sofn.model.generator.AdsMonitorTask" >
        <id column="ID" property="id" jdbcType="VARCHAR" />
        <result column="TASK_NAME" property="taskName" jdbcType="VARCHAR" />
        <result column="MONITOR_CLASS" property="monitorClass" jdbcType="VARCHAR" />
        <result column="RELEASE_UNIT" property="releaseUnit" jdbcType="VARCHAR" />
        <result column="CHECK_MODEL" property="checkModel" jdbcType="VARCHAR" />
        <result column="YEAR" property="year" jdbcType="VARCHAR" />
        <result column="BATCH" property="batch" jdbcType="VARCHAR" />
        <result column="SEPARATION" property="separation" jdbcType="DECIMAL" />
        <result column="START_TIME" property="startTime" jdbcType="VARCHAR" />
        <result column="END_TIME" property="endTime" jdbcType="VARCHAR" />
        <result column="DEADLINE" property="deadline" jdbcType="VARCHAR" />
        <result column="ATTACHMENT" property="attachment" jdbcType="VARCHAR" />
        <result column="ATTACHMENTCODE" property="attachmentcode" jdbcType="VARCHAR" />
        <result column="COMMENT" property="comment" jdbcType="VARCHAR" />
        <result column="PUBLISH_STATUS" property="publishStatus" jdbcType="DECIMAL" />
        <result column="INDUSTRY" property="industry" jdbcType="VARCHAR" />
        <result column="JUDGE_STANDARD" property="judgeStandard" jdbcType="VARCHAR" />
        <result column="SAMPLE_LINK" property="sampleLink" jdbcType="VARCHAR" />
        <result column="CHECK_OBJECT" property="checkObject" jdbcType="VARCHAR" />
        <result column="CHECK_PROJECT" property="checkProject" jdbcType="VARCHAR" />
        <result column="DEL_FLAG" property="delFlag" jdbcType="VARCHAR" />
        <result column="CREATE_BY" property="createBy" jdbcType="VARCHAR" />
        <result column="UPDATE_BY" property="updateBy" jdbcType="VARCHAR" />
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
        <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
        <result column="ATTACHMENT_ADDRESS" property="attachmentAddress" jdbcType="VARCHAR" />
        <result column="RN" property="rn" jdbcType="INTEGER" />
        <result column="SUP_ID" property="supId" jdbcType="VARCHAR" />
        <collection property="adsOrganTaskList" column="monitorTaskId"  ofType="com.sofn.model.generator.AdsOrganTask"  >
            <id column="OrganTaskID" property="id" jdbcType="VARCHAR"/>
            <result column="SAMPLE_ORGAN" property="sampleOrgan" jdbcType="VARCHAR"/>
            <result column="DETECTION_ORGAN" property="detectionOrgan" jdbcType="VARCHAR"/>
            <result column="MONITOR_TASK_ID" property="monitorTaskId" jdbcType="VARCHAR"/>
            <result column="REG_ID" property="regId" jdbcType="VARCHAR"/>
            <result column="REG_NAME" property="regName" jdbcType="VARCHAR"/>
            <result column="NUMBERS" property="numbers" jdbcType="DECIMAL"/>
            <result column="CITY_NAME" property="cityName" jdbcType="VARCHAR"/>
            <result column="SAMPLE_FINISH_NUM" property="sampleFinishNum" jdbcType="VARCHAR"/>
        </collection>
    </resultMap>
    <!--任务列表-->
    <select id="getRoutineMonitorList" parameterType="hashmap" resultMap="BaseResultMap">
        select t.*
        from (select tmp.*, rownum rn
        from (select amt.id,
        amt.task_name,
        amt.monitor_class,
        amt.release_unit,
        amt.check_model,
        amt.year,
        amt.batch,
        amt.separation,
        amt.INDUSTRY,
        amt.create_by,
        amt.TASK_SOURCE,
        amt.SAMPLE_LINK,
        amt.CHECK_OBJECT,
        amt.CHECK_PROJECT,
        amt.publish_status,
        amt.create_time,
        to_char(amt.DEADLINE,'yyyy-mm-dd') DEADLINE,
        to_char(amt.start_time,'yyyy-mm-dd') start_time,
        to_char(amt.end_time,'yyyy-mm-dd') end_time
        from ADS_MONITOR_TASK amt,ADS_ORGAN_TASK t
        where 1 = 1 AND amt.DEL_FLAG != 'Y' AND t.DEL_FLAG != 'Y' AND t.MONITOR_TASK_ID = amt.id AND amt.publish_status != '0'
        <if test="taskName!=null and taskName!='' and taskName!='不限'">
            AND amt.TASK_NAME like #{taskName}
        </if>
        <if test="year!=null and year!='' and year!='不限'">
            AND amt.YEAR = #{year}
        </if>
        <if test="cstartTime!=null and cstartTime!='' and cstartTime!='不限'">
            AND amt.CREATE_TIME &gt;=to_date(#{cstartTime},'yyyy-MM-dd')
        </if>
        <if test="cendTime!=null and cendTime!='' and cendTime!='不限'">
            AND amt.CREATE_TIME &lt;=to_date(#{cendTime},'yyyy-MM-dd')+1
        </if>
        <if test="startTime!=null and startTime!='' and startTime!='不限'">
            AND amt.START_TIME &gt;=to_date(#{startTime},'yyyy-MM-dd')
        </if>
        <if test="endTime!=null and endTime!='' and endTime!='不限'">
            AND amt.END_TIME &lt;=to_date(#{endTime},'yyyy-MM-dd')+1
        </if>
        <if test="monitorClass!=null and monitorClass!='' and monitorClass!='不限'">
            AND amt.MONITOR_CLASS = #{monitorClass}
        </if>
        <if test="industry!=null and industry!='' and industry!='不限'">
            AND amt.INDUSTRY = #{industry}
        </if>
        <if test="ReleaseUnit!=null and ReleaseUnit!='' and ReleaseUnit!='不限'">
            AND amt.RELEASE_UNIT = #{ReleaseUnit}
        </if>
        <if test="SampleLink!=null and SampleLink!='' and SampleLink!='不限'">
            AND amt.SAMPLE_LINK = #{SampleLink}
        </if>
        <if test="orgType=='ADS'">
            AND (t.SAMPLE_ORGAN_ID = #{orgId} OR t.DETECTION_ORGAN_ID = #{orgId})
        </if>
        <if test="orgType!='ADS' and orgLevel!='1'">
            AND lower(amt.CREATE_ORG_REGION_ID ) like lower(trim(#{regionId})) ||'%'
        </if>
        order by amt.start_time desc,amt.update_time desc,amt.create_time desc,amt.id desc) tmp
        <![CDATA[
        where rownum <= #{pageSize}*#{pageNum}) t
        where t.rn >= 1+#{pageSize}*(#{pageNum}-1)  ]]>
    </select>

    <select id="getRoutineMonitorCount" resultType="java.lang.Long">
        SELECT COUNT(*)
        from ADS_MONITOR_TASK amt,ADS_ORGAN_TASK t
        where 1 = 1 AND amt.DEL_FLAG != 'Y' AND t.DEL_FLAG != 'Y' AND t.MONITOR_TASK_ID = amt.id AND amt.publish_status != '0'
        <if test="area!=null and area!='' and area!='不限'">
            AND lower(amt.CREATE_ORG_REGION_ID ) like lower(trim(#{area})) ||'%'
        </if>
        <if test="year!=null and year!='' and year!='不限'">
            AND amt.YEAR = #{year}
        </if>
        <if test="cstartTime!=null and cstartTime!='' and cstartTime!='不限'">
            AND amt.CREATE_TIME &gt;=to_date(#{cstartTime},'yyyy-MM-dd')
        </if>
        <if test="cendTime!=null and cendTime!='' and cendTime!='不限'">
            AND amt.CREATE_TIME &lt;=to_date(#{cendTime},'yyyy-MM-dd')+1
        </if>
        <if test="startTime!=null and startTime!='' and startTime!='不限'">
            AND amt.START_TIME &gt;=to_date(#{startTime},'yyyy-MM-dd')
        </if>
        <if test="endTime!=null and endTime!='' and endTime!='不限'">
            AND amt.END_TIME &lt;=to_date(#{endTime},'yyyy-MM-dd')+1
        </if>
        <if test="monitorClass!=null and monitorClass!='' and monitorClass!='不限'">
            AND amt.MONITOR_CLASS = #{monitorClass}
        </if>
        <if test="industry!=null and industry!='' and industry!='不限'">
            AND amt.INDUSTRY = #{industry}
        </if>
        <if test="ReleaseUnit!=null and ReleaseUnit!='' and ReleaseUnit!='不限'">
            AND amt.RELEASE_UNIT = #{ReleaseUnit}
        </if>
        <if test="SampleLink!=null and SampleLink!='' and SampleLink!='不限'">
            AND amt.SAMPLE_LINK = #{SampleLink}
        </if>
        <if test="orgType=='ADS'">
            AND (t.SAMPLE_ORGAN_ID = #{orgId} OR t.DETECTION_ORGAN_ID = #{orgId})
        </if>
        <if test="orgType!='ADS' and orgLevel!='1'">
            AND lower(amt.CREATE_ORG_REGION_ID ) like lower(trim(#{regionId})) ||'%'
        </if>
    </select>

    <select id="getIndustry" parameterType="hashmap" resultType="map">
        select DISTINCT amt.industry
        from ADS_MONITOR_TASK amt
        where 1 = 1 AND amt.DEL_FLAG != 'Y' AND (amt.MONITOR_CLASS = '例行监测' OR amt.MONITOR_CLASS = '专项检测' OR amt.MONITOR_CLASS = '监督抽查')
    </select>

    <select id="getReleaseUnit" parameterType="hashmap" resultType="map">
        select DISTINCT amt.RELEASE_UNIT
        from ADS_MONITOR_TASK amt
        where 1 = 1 AND amt.DEL_FLAG != 'Y' AND (amt.MONITOR_CLASS = '例行监测' OR amt.MONITOR_CLASS = '专项检测' OR amt.MONITOR_CLASS = '监督抽查')
    </select>

    <select id="getSampleLink" parameterType="hashmap" resultType="map">
        select DISTINCT amt.SAMPLE_LINK
        from ADS_MONITOR_TASK amt
        where 1 = 1 AND amt.DEL_FLAG != 'Y' AND (amt.MONITOR_CLASS = '例行监测' OR amt.MONITOR_CLASS = '专项检测' OR amt.MONITOR_CLASS = '监督抽查')
    </select>

    <select id="getDetectionOrgan" parameterType="hashmap" resultMap="BaseResultMapForOrganTask">
        select DISTINCT o.Detection_Organ
        from ADS_MONITOR_TASK amt,Ads_Organ_Task o
        where 1 = 1 AND amt.DEL_FLAG != 'Y' AND o.DEL_FLAG != 'Y' AND o.Monitor_Task_Id = amt.id AND (amt.MONITOR_CLASS = '例行监测' OR amt.MONITOR_CLASS = '专项检测' OR amt.MONITOR_CLASS = '监督抽查')
    </select>

    <select id="getSampleOrgan" parameterType="hashmap" resultMap="BaseResultMapForOrganTask">
        select DISTINCT o.Sample_Organ
        from ADS_MONITOR_TASK amt,Ads_Organ_Task o
        where 1 = 1 AND amt.DEL_FLAG != 'Y' AND o.DEL_FLAG != 'Y' AND o.Monitor_Task_Id = amt.id AND (amt.MONITOR_CLASS = '例行监测' OR amt.MONITOR_CLASS = '专项检测' OR amt.MONITOR_CLASS = '监督抽查')
    </select>

    <select id="findAdsMonitorTaskById" resultMap="joinSelectScore" parameterType="hashmap">
        select b.ID,b.TASK_NAME,b.MONITOR_CLASS,b.RELEASE_UNIT,b.CHECK_MODEL,b.year,b.BATCH,b.SEPARATION,
        to_char(b.START_TIME,'yyyy-mm-dd') START_TIME ,to_char(b.END_TIME,'yyyy-mm-dd')  END_TIME,
        to_char(b.DEADLINE,'yyyy-mm-dd') DEADLINE,b.PUBLISH_STATUS,b.ATTACHMENT,b.ATTACHMENTCODE,b.INDUSTRY,b.SUP_ID,
        b.JUDGE_STANDARD,b.SAMPLE_LINK,b.CHECK_OBJECT,b.CHECK_PROJECT,b.DEL_FLAG,b.CREATE_BY,b.UPDATE_BY,b."COMMENT",a.SAMPLE_FINISH_NUM,
        a.SAMPLE_ORGAN,a.MONITOR_TASK_ID,a.DETECTION_ORGAN,a.REG_ID,a.NUMBERS,a.ID OrganTaskID,a.CITY_NAME,b.ATTACHMENT_ADDRESS
        from  ADS_MONITOR_TASK b left join ADS_ORGAN_TASK a  on a.MONITOR_TASK_ID=b.ID
        WHERE a.DEL_FLAG != 'Y' AND b.DEL_FLAG != 'Y' AND b.PUBLISH_STATUS !='0'
        <if test="monitorTaskId!=null and monitorTaskId!=''">
            AND a.MONITOR_TASK_ID=#{monitorTaskId}
        </if>
        <if test="monitorClass!=null and monitorClass!=''">
            AND b.MONITOR_CLASS=#{monitorClass}
        </if>
        <if test="sampleOrganId!=null and sampleOrganId!=''">
            AND (a.SAMPLE_ORGAN_ID=#{sampleOrganId}
        </if>
        <if test="detectionOrganId!=null and detectionOrganId!=''">
            OR a.DETECTION_ORGAN_ID=#{detectionOrganId})
        </if>
    </select>

    <!--任务列表-->
    <select id="getSpecialMonitorList" resultType="java.util.Map">
        SELECT * FROM(
        SELECT
        N.*,ROWNUM AS rn FROM (
        SELECT
        M.ID AS id,
        M.SM_NAME AS smName,
        M.SM_TYPE AS smType,
        M.SM_MODEL_ID AS smModelId,
        M.SM_YEAR AS smYear,
        M.SM_BATCH AS smBatch,
        M.SM_DATE_BEGIN AS smDateBegin,
        M.SM_DATE_END AS smDateEnd,
        M.SM_RELEASE_UNIT AS smReleaseUnit,
        M.SM_FILE AS smFile,
        M.SM_FILE_NUM AS smFileNum,
        M.SM_REMARK AS smRemark,
        M.CREATE_BY AS createBy,
        M.CREATE_TIME AS createTime,
        M.UPDATE_BY AS updateBy,
        M.UPDATE_TIME AS updateTime,
        M.ENABLE AS enable,
        M.SM_STATE AS smState,
        M.CREATE_ORG_REGION_ID AS createOrgRegionId
        FROM
        ASMS_SPECIAL_MONITOR M
        WHERE 1=1 AND M.DEL_FLAG='N'
        <if test="regParm!=null and regParm!=''">
            AND M.CREATE_ORG_REGION_ID LIKE #{regParm}
        </if>
        <if test="smState!=null and smState!=''">
            AND M.SM_STATE = #{smState}
        </if>
        <if test="smYear!=null and smYear!=''">
            AND M.SM_YEAR = #{smYear}
        </if>
        <if test="smName!=null and smName!=''">
            AND M.SM_NAME LIKE #{smName}
        </if>
        <if test="dateBegin!=null and dateBegin!=''">
            AND M.SM_DATE_BEGIN &gt;=to_date(#{dateBegin},'yyyy-MM-dd')
        </if>
        <if test="dateEnd!=null and dateEnd!=''">
            AND M.SM_DATE_END &lt;=to_date(#{dateEnd},'yyyy-MM-dd')+1
        </if>
        order by M.CREATE_TIME DESC
        ) N)
        WHERE rn BETWEEN 1+#{pageSize}*(#{pageNum}-1) AND #{pageSize}*#{pageNum}
    </select>

    <select id="getSpecialMonitorCount" resultType="java.lang.Long">
        SELECT COUNT(*) FROM ASMS_SPECIAL_MONITOR M
        WHERE 1=1 AND M.DEL_FLAG='N'
        <if test="regParm!=null and regParm!=''">
            AND M.CREATE_ORG_REGION_ID LIKE #{regParm}
        </if>
        <if test="smState!=null and smState!=''">
            AND M.SM_STATE = #{smState}
        </if>
        <if test="smName!=null and smName!=''">
            AND M.SM_NAME LIKE #{smName}
        </if>
        <if test="dateBegin!=null and dateBegin!=''">
            AND M.SM_DATE_BEGIN &gt;=to_date(#{dateBegin},'yyyy-MM-dd')
        </if>
        <if test="dateEnd!=null and dateEnd!=''">
            AND M.SM_DATE_END &lt;=to_date(#{dateEnd},'yyyy-MM-dd')+1
        </if>
    </select>

    <!--列表-->
    <select id="getCheckTaskList" resultType="java.util.Map">
        SELECT * FROM(
        SELECT
        N.*,ROWNUM AS rn FROM (
        SELECT
        M.ID AS id,
        M.TASK_NAME AS taskName,
        M.TASK_TYPE AS taskType,
        M.TASK_YEAR AS taskYear,
        M.TASK_BEGIN_TIME AS taskBeginTime,
        M.TASK_END_TIME AS taskEndTime,
        M.TASK_RELEASE_UNIT AS taskReleaseUnit,
        M.FILES AS files,
        M.FILE_CODE AS fileCode,
        M.REMARK AS remark,
        M.TASK_LEVEL AS taskLevel,
        M.STATE AS state,
        M.CREATE_BY AS createBy,
        M.CREATE_TIME AS createTime,
        M.UPDATE_BY AS updateBy,
        M.UPDATE_TIME AS updateTime,
        M.ENABLE AS enable,
        M.DEL_FLAG AS delFlag,
        M.CREATE_ORG_REGION_ID AS createOrgRegionId,
        M.BASE_INSPECTION_ID AS baseInspectionId,
        M.CY_UNIT_ID AS cyUnitId,
        M.CY_UNIT_NAME AS cyUnitName,
        M.JC_UNIT_ID AS jcUnitId,
        M.JC_UNIT_NAME AS jcUnitName,
        M.IS_SAMPLE AS isSample,
        M.JUDGE_STANDARD AS judgeStandard,
        M.JUDGE_STANDARD_ID AS judgeStandardId,
        M.DETECTION_STANDARD AS detectionStandard,
        M.DETECTION_STANDARD_ID AS detectionStandardId,
        M.PARENT_TASK_ID AS parentTaskId,
        M.PARENT_TASK_NAME AS parentTaskName,
        M.CREATE_ORG_ID AS createOrgId,
        M.CREATE_ORG_NAME AS createOrgName
        FROM
        ASMS_CHECK_TASK M
        WHERE 1=1 AND M.DEL_FLAG = 'N'
        AND M.TASK_LEVEL = '${taskLevel}'
        <if test="regParm!=null and regParm!=''">
            AND M.CREATE_ORG_REGION_ID LIKE #{regParm}
        </if>
        <if test="state!=null and state!=''">
            AND M.STATE = #{state}
        </if>
        <if test="taskName!=null and taskName!=''">
            AND M.TASK_NAME LIKE #{taskName}
        </if>
        <if test="dateBegin!=null and dateBegin!=''">
            AND M.TASK_BEGIN_TIME &gt;=to_date(#{dateBegin},'yyyy-MM-dd')
        </if>
        <if test="dateEnd!=null and dateEnd!=''">
            AND M.TASK_END_TIME &lt;=to_date(#{dateEnd},'yyyy-MM-dd')+1
        </if>
        order by M.CREATE_TIME DESC
        ) N)
        WHERE rn BETWEEN 1+#{pageSize}*(#{pageNum}-1) AND #{pageSize}*#{pageNum}
    </select>

    <select id="getCheckTaskCount" resultType="java.lang.Long">
        SELECT COUNT(*) FROM ASMS_CHECK_TASK M
        WHERE 1=1 AND M.DEL_FLAG = 'N'
        AND M.TASK_LEVEL = '${taskLevel}'
        <if test="regParm!=null and regParm!=''">
            AND M.CREATE_ORG_REGION_ID LIKE #{regParm}
        </if>
        <if test="state!=null and state!=''">
            AND M.STATE = #{state}
        </if>
        <if test="taskName!=null and taskName!=''">
            AND M.TASK_NAME LIKE #{taskName}
        </if>
        <if test="dateBegin!=null and dateBegin!=''">
            AND M.TASK_BEGIN_TIME &gt;=to_date(#{dateBegin},'yyyy-MM-dd')
        </if>
        <if test="dateEnd!=null and dateEnd!=''">
            AND M.TASK_END_TIME &lt;=to_date(#{dateEnd},'yyyy-MM-dd')+1
        </if>
    </select>

    <!--列表-->
    <select id="getReCheckTaskList" resultType="java.util.Map">
        SELECT * FROM(
        SELECT
        N.*,ROWNUM AS rn FROM (
        SELECT
        M.ID AS id,
        M.RECHECK_TASK_NAME AS recheckTaskName,
        M.RECHECK_TASK_YEAR AS recheckTaskYear,
        M.RECHECK_TASK_BEGIN AS recheckTaskBegin,
        M.RECHECK_TASK_END AS recheckTaskEnd,
        M.CREATE_BY AS createBy,
        M.CREATE_TIME AS createTime,
        M.UPDATE_BY AS updateBy,
        M.UPDATE_TIME AS updateTime,
        M.ENABLE AS enable,
        M.STATE AS state,
        M.DEL_FLAG AS delFlag,
        M.INIT_TASK_TYPE AS initTaskType,
        M.INIT_TASK_NAME AS initTaskName,
        M.INIT_TASK_ID AS initTaskId,
        M.RECHECK_UNIT_ID AS recheckUnitId,
        M.RECHECK_UNIT_NAME AS recheckUnitName,
        M.CREATE_ORG_ID AS createOrgId,
        M.CREATE_ORG_NAME AS createOrgName,
        M.BATCH AS batch
        FROM
        ASMS_RECHECK_TASK M
        WHERE 1=1 AND M.DEL_FLAG='N'
        <if test="state!=null and state!=''">
            AND M.STATE = #{state}
        </if>
        <if test="recheckTaskName!=null and recheckTaskName!=''">
            AND M.RECHECK_TASK_NAME LIKE #{recheckTaskName}
        </if>
        <if test="recheckTaskYear!=null and recheckTaskYear!=''">
            AND M.RECHECK_TASK_YEAR LIKE #{recheckTaskYear}
        </if>
        <if test="dateBegin!=null and dateBegin!=''">
            AND M.RECHECK_TASK_BEGIN &gt;=to_date(#{dateBegin},'yyyy-MM-dd')
        </if>
        <if test="dateEnd!=null and dateEnd!=''">
            AND M.RECHECK_TASK_END &lt;=to_date(#{dateEnd},'yyyy-MM-dd')
        </if>
        order by M.CREATE_TIME DESC
        ) N)
        WHERE rn BETWEEN 1+#{pageSize}*(#{pageNum}-1) AND #{pageSize}*#{pageNum}
    </select>

    <select id="getReCheckTaskCount" resultType="java.lang.Long">
        SELECT COUNT(*) FROM ASMS_RECHECK_TASK M
        WHERE 1=1 AND M.DEL_FLAG='N'
        <if test="state!=null and state!=''">
            AND M.STATE = #{state}
        </if>
        <if test="recheckTaskName!=null and recheckTaskName!=''">
            AND M.RECHECK_TASK_NAME LIKE #{recheckTaskName}
        </if>
        <if test="recheckTaskYear!=null and recheckTaskYear!=''">
            AND M.RECHECK_TASK_YEAR LIKE #{recheckTaskYear}
        </if>
        <if test="dateBegin!=null and dateBegin!=''">
            AND M.RECHECK_TASK_BEGIN &gt;=to_date(#{dateBegin},'yyyy-MM-dd')
        </if>
        <if test="dateEnd!=null and dateEnd!=''">
            AND M.RECHECK_TASK_END &lt;=to_date(#{dateEnd},'yyyy-MM-dd')
        </if>
    </select>

    <select id="getPageInfoByMonitorTaskID" parameterType="hashmap" resultMap="BaseResultMap">
        select t.*
        from (select tmp.*, rownum rn
        from (select  so.id,
        so.sample_organ,
        so.DETECTION_ORGAN,
        so.numbers,
        so.sample_finish_num,
        so.sample_report_status,
        to_char(so.sample_report_time,'yyyy-mm-dd hh24:mi:ss') sample_report_time,
        so.check_finish_num,
        so.check_report_status,
        to_char(so.check_report_time,'yyyy-mm-dd hh24:mi:ss') check_report_time,
        so.SAMPLE_ORGAN_ID,
        so.DETECTION_ORGAN_ID
        from Ads_Organ_Task so,Ads_Monitor_Task b
        where 1 = 1
        AND so.DEL_FLAG != 'Y'
        AND so.MONITOR_TASK_ID = b.ID
        <if test="publishStatus!=null and publishStatus!=''">
            AND  b.publish_status = #{publishStatus}
        </if>
        <if test="monitorClass != null and monitorClass !=''">
            AND b.monitor_class = #{monitorClass}
        </if>
        <if test="year != null and year !=''">
            AND b.year = #{year}
        </if>
        <if test="taskName != null and taskName !=''">
            AND b.task_name = #{taskName}
        </if>
        <if test="monitorTaskId != null and monitorTaskId !=''">
            AND b.ID = #{monitorTaskId}
        </if>
        <if test="sampleOrgan!=null and sampleOrgan!=''">
            AND lower(so.sample_organ) like '%' || lower(trim(#{sampleOrgan})) ||'%'
        </if>
        <if test="detectionOrgan!=null and detectionOrgan!=''">
            AND lower(so.detection_organ) like '%' || lower(trim(#{detectionOrgan})) ||'%'
        </if>
        order by so.update_time desc,
        so.create_time desc,so.id desc) tmp
        <![CDATA[
            where rownum <= #{pageSize}*#{pageNum}) t
       where t.rn >= 1+#{pageSize}*(#{pageNum}-1)  ]]>
    </select>

    <select id="getCountByMonitorTaskID" parameterType="hashmap" resultType="long">
        SELECT COUNT(1) from Ads_Organ_Task so,Ads_Monitor_Task b
        where 1 = 1 AND so.DEL_FLAG != 'Y'
        AND so.MONITOR_TASK_ID = b.ID
        <if test="publishStatus!=null and publishStatus!=''">
            AND b.publish_status = #{publishStatus}
        </if>
        <if test="monitorClass != null and monitorClass !=''">
            AND b.monitor_class = #{monitorClass}
        </if>
        <if test="year != null and year !=''">
            AND b.year = #{year}
        </if>
        <if test="taskName != null and taskName !=''">
            AND b.task_name = #{taskName}
        </if>
        <if test="monitorTaskId != null and monitorTaskId !=''">
            AND so.MONITOR_TASK_ID = #{monitorTaskId}
        </if>
        <if test="sampleOrgan!=null and sampleOrgan!=''">
            AND lower(so.sample_organ) like '%' || lower(trim(#{sampleOrgan})) ||'%'
        </if>
        <if test="detectionOrgan!=null and detectionOrgan!=''">
            AND lower(so.detection_organ) like '%' || lower(trim(#{detectionOrgan})) ||'%'
        </if>
    </select>

    <select id="getPageInfoByMonitorTask" parameterType="hashmap" resultMap="BaseResultMapForOrganTask">
        select t.*
        from (select tmp.*, rownum rn
        from (select aot.id,
        aot.monitor_task_id,
        aot.sample_organ,
        aot.sample_organ_id,
        aot.detection_organ,
        aot.detection_organ_id,
        aot.city_code,
        aot.city_name,
        aot.FINISH_NUM,
        aot.REPORT_STATUS,
        aot.REPORT_TIME,
        aot.TASKS_STATUS,
        aot.SAMPLE_FINISH_NUM,
        aot.CHECK_FINISH_NUM,
        aot.numbers,
        aot.deparment,
        aot.deparment_id,
        to_char(aot.upload_time,'yyyy-mm-dd') upload_time
        from ADS_ORGAN_TASK aot
        where 1 = 1 AND aot.DEL_FLAG != 'Y'
        AND aot.monitor_task_id = #{monitorTaskId}
        <if test="sampleOrgan!=null and sampleOrgan!=''">
            AND lower(aot.sample_organ) like '%' || lower(trim(#{sampleOrgan})) ||'%'
        </if>
        <if test="detectionOrgan!=null and detectionOrgan!=''">
            AND lower(aot.detection_organ) like '%' || lower(trim(#{detectionOrgan})) ||'%'
        </if>
        order by aot.update_time desc,aot.create_time desc,aot.id desc) tmp
        <![CDATA[
            where rownum <= #{pageSize}*#{pageNum}) t
       where t.rn >= 1+#{pageSize}*(#{pageNum}-1)  ]]>
    </select>

    <select id="getCountByMonitorTask" parameterType="hashmap" resultType="long">
        SELECT COUNT(1) FROM ADS_ORGAN_TASK aot
        where 1 = 1 AND aot.DEL_FLAG != 'Y'
        AND aot.monitor_task_id = #{monitorTaskId}
        <if test="sampleOrgan!=null and sampleOrgan!=''">
            AND lower(aot.sample_organ) like '%' || lower(trim(#{sampleOrgan})) ||'%'
        </if>
        <if test="detectionOrgan!=null and detectionOrgan!=''">
            AND lower(aot.detection_organ) like '%' || lower(trim(#{detectionOrgan})) ||'%'
        </if>
    </select>

</mapper>